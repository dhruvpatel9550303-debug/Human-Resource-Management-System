<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payroll | Dhruv HRMS</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="components/navbar.js"></script>
    <script src="components/sidebar.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <custom-navbar></custom-navbar>
    <custom-sidebar></custom-sidebar>

    <main class="ml-64 p-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-2xl font-bold text-gray-800">Payroll Management</h1>
            <div class="flex gap-4">
                <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                    <i data-feather="download" class="w-4 h-4 mr-2"></i>
                    Export
                </button>
                <button class="border border-gray-300 bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg">
                    <i data-feather="printer" class="w-4 h-4 mr-2"></i>
                    Print
                </button>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold">Salary Summary</h2>
                <button id="updateSalaryBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm hidden">
                    <i data-feather="edit" class="w-4 h-4 mr-2"></i>
                    Update Salary Structure
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="border border-gray-200 rounded-lg p-4">
                    <p class="text-gray-500 text-sm">Basic Salary</p>
                    <h3 class="text-2xl font-bold mt-1" id="basicSalary">$3,450.00</h3>
                </div>
                <div class="border border-gray-200 rounded-lg p-4">
                    <p class="text-gray-500 text-sm">Allowances</p>
                    <h3 class="text-2xl font-bold mt-1" id="allowances">$450.00</h3>
                </div>
                <div class="border border-gray-200 rounded-lg p-4">
                    <p class="text-gray-500 text-sm">Deductions</p>
                    <h3 class="text-2xl font-bold mt-1" id="deductions">$320.50</h3>
                </div>
            </div>
        </div>

        <!-- Admin Salary Update Modal -->
        <div id="salaryUpdateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
            <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                <div class="mt-3">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-medium text-gray-900">Update Salary Structure</h3>
                        <button id="closeSalaryModal" class="text-gray-400 hover:text-gray-600">
                            <i data-feather="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    <form id="salaryUpdateForm" novalidate>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Basic Salary</label>
                            <input type="number" id="newBasicSalary" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="3450" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Allowances</label>
                            <input type="number" id="newAllowances" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="450" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Deductions</label>
                            <input type="number" id="newDeductions" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" value="320.50" required>
                        </div>
                        <div class="flex justify-end gap-4">
                            <button type="button" id="cancelSalaryBtn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400">Cancel</button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-lg font-semibold mb-4">Recent Payslips</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Period</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Payment Date</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Basic Salary</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Net Pay</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="payrollTable">
                        <!-- Payroll records will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        feather.replace();
        
        // Simulate loading payroll data
        document.addEventListener('DOMContentLoaded', () => {
            loadPayrollData();
            
            // Check if user is admin
            const isAdmin = localStorage.getItem('isAdmin') === 'true';
            if (isAdmin) {
                document.getElementById('updateSalaryBtn').classList.remove('hidden');
                setupSalaryUpdate();
            }
        });
        
        function setupSalaryUpdate() {
            const updateBtn = document.getElementById('updateSalaryBtn');
            const modal = document.getElementById('salaryUpdateModal');
            const closeBtn = document.getElementById('closeSalaryModal');
            const cancelBtn = document.getElementById('cancelSalaryBtn');
            const form = document.getElementById('salaryUpdateForm');
            
            updateBtn.addEventListener('click', () => {
                modal.classList.remove('hidden');
            });
            
            closeBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
            
            cancelBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
            });
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const basic = parseFloat(document.getElementById('newBasicSalary').value);
                const allowances = parseFloat(document.getElementById('newAllowances').value);
                const deductions = parseFloat(document.getElementById('newDeductions').value);
                
                document.getElementById('basicSalary').textContent = `$${basic.toFixed(2)}`;
                document.getElementById('allowances').textContent = `$${allowances.toFixed(2)}`;
                document.getElementById('deductions').textContent = `$${deductions.toFixed(2)}`;
                
                modal.classList.add('hidden');
                alert('Salary structure updated successfully!');
            });
        }

        function loadPayrollData() {
            const data = [
                { period: 'June 2023', date: '2023-06-30', basic: '$3,450.00', net: '$3,579.50', status: 'Paid' },
                { period: 'May 2023', date: '2023-05-31', basic: '$3,450.00', net: '$3,579.50', status: 'Paid' },
                { period: 'April 2023', date: '2023-04-28', basic: '$3,450.00', net: '$3,579.50', status: 'Paid' },
                { period: 'March 2023', date: '2023-03-31', basic: '$3,200.00', net: '$3,329.50', status: 'Paid' }
            ];

            const tableBody = document.getElementById('payrollTable');
            tableBody.innerHTML = data.map(item => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.period}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.basic}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.net}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            ${item.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button class="text-blue-600 hover:text-blue-800 mr-3">View</button>
                        <button class="text-blue-600 hover:text-blue-800">Download</button>
                    </td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
